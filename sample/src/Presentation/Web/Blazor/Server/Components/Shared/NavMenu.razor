@using Cheetah.Core.Aggregates.AIAggregate.Facts
@inject IConfiguration Configuration
@inherits SharedPage
<MudNavMenu>
    @if (bool.Parse(@Configuration["AI:Enable"]!))
    {
        <AuthorizeView>
            <MudNavLink Href="AI" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.Assistant">
                دستیار هوشمند
            </MudNavLink>
        </AuthorizeView>
        <AuthorizeView Roles="Admin">         
            <MudNavLink Href="MangePages" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.AdfScanner">
                مدیریت صفحه ها
            </MudNavLink>
            @foreach (F_PageTable Record in Records)
            {
                <MudNavLink Href="@string.Concat("CustomPage\\",Record.Name)" Match="NavLinkMatch.Prefix" Icon="@GetIcon(Record.Icon)">
                    @Record.DisplayName
                </MudNavLink>
            }
                   <MudNavLink Href="FileUpload" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.FileUpload">
                    مدیریت بارگذاری ها
                </MudNavLink>
        </AuthorizeView>
    }
    else
    {
        <MudNavLink Href="Contact" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.ContactPhone">
            ارتباط با ما
        </MudNavLink>
    }
    <AuthorizeView Roles="Admin">
        <MudNavLink Href="List" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.List">
            ویرایش پارامتر
        </MudNavLink>
    </AuthorizeView>
    <AuthorizeView>
        <MudNavLink Href="Inbox" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.Inbox">
            صندوق ورودی
        </MudNavLink>
        <MudNavLink Href="Sent" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.Outbox">
            صندوق خروجی
        </MudNavLink>
    </AuthorizeView>
</MudNavMenu>

@code
{
    private string GetIcon(string iconName)
    {
        return (typeof(Icons.Material.Filled).GetField(iconName)?.GetValue(null) as string);
    }
    protected async override Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            Records = await _db.F_PageTables.ToListAsync();
            StateHasChanged();
        }
    }
}